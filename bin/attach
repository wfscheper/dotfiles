#!/usr/bin/env fish
if test (count $argv) -gt 1
    echo "usage: attach [SESSION]"
    exit 2
end

if test "$TMUX"
    echo "error: already attached to a tmux session"
    exit 2
end

if test "$argv[1]"
    set session "$argv[1]"
else
    set session "main"
end

# set up symlink to ssh-agent socket
if test -n "$SSH_TTY" -a -n "$SSH_AUTH_SOCK"
    ln -sfn $SSH_AUTH_SOCK ~/.ssh_auth_sock_$session
end

if not tmux ls -F '#S' ^/dev/null | grep -q $session
    tmux new-session -d -s $session
    # create extra windows and set default layouts here
end
tmux attach-session -d -t $session
if test -e ~/.ssh_auth_sock_$session
    rm ~/.ssh_auth_sock_$session
end
